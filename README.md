# 512890 红利低波ETF回测系统

基于市值加权的ETF持仓回测系统，支持静态和动态两种回测模式，符合基金"双十规定"。

## 🚀 快速开始

```bash
# 1. 安装依赖
npm install

# 2. 配置环境变量（创建 .env 文件）
TUSHARE_TOKEN=your_token_here

# 3. 启动服务
npm start

# 4. 访问系统
# 浏览器打开 http://localhost:3001
```

## 📊 功能说明

### 静态回测
- **原理**：使用最新披露的持仓，回测历史表现
- **适用场景**：快速评估当前持仓策略
- **展示内容**：单期持仓详情、权重分布、收益对比

### 动态回测
- **原理**：跟随ETF每次持仓披露（中报/年报），动态调整组合
- **适用场景**：模拟真实投资过程
- **展示内容**：
  - 多个调仓周期详情
  - 每期持仓变化（新增/移除/继续持有）
  - 连续净值曲线
  - 分周期收益统计

## 💡 权重策略

**市值加权 + 10%上限约束**

符合中国基金监管的"双十规定"（单只股票不超过基金资产净值的10%）

### 计算步骤

1. **初始权重**：按市值比例计算
   ```
   初始权重 = 股票市值 / 所有股票市值之和
   ```

2. **10%上限约束**：迭代调整法
   - 找出所有超过10%的股票
   - 将超限股票截断为10%
   - 超出部分按原始权重比例分配给未超限股票
   - 重复直到所有股票≤10%

### 算法示例

```
初始权重：
  工商银行: 15% → 截断为10%，释放5%
  建设银行: 12% → 截断为10%，释放2%
  其他82只: 73% → 分配7%，变为80%

最终权重：
  工商银行: 10.00%
  建设银行: 10.00%
  其他82只: 80.00%（按比例分配）
```

### 策略特点

- ✅ **合规性**：符合基金监管要求
- ✅ **经济意义**：保持市值加权的核心逻辑
- ✅ **公平性**：超出部分按比例公平分配
- ✅ **风险分散**：避免单只股票权重过高

## 📈 数据来源

| 数据类型 | 接口 | 字段 | 说明 |
|---------|------|------|------|
| 持仓数据 | `fund_portfolio` | 股票代码、持仓比例 | ETF定期报告 |
| 价格数据 | `daily` | 收盘价（后复权） | 日线行情 |
| 市值数据 | `daily_basic` | `total_mv` | 总市值（万元） |
| 基本信息 | `stock_basic` | 股票名称、行业 | 基础信息 |

## 🏗️ 技术架构

```
├── 后端
│   ├── Node.js + Express    # API服务
│   ├── Axios                # HTTP请求
│   └── Tushare API          # 金融数据
│
├── 前端
│   ├── 原生JavaScript       # 交互逻辑
│   ├── Chart.js             # 图表可视化
│   └── 响应式CSS            # 界面设计
│
└── 数据处理
    ├── 批量处理             # 避免API限流
    ├── 迭代权重调整         # 10%约束算法
    └── 净值计算             # 组合收益计算
```

## 📁 项目结构

```
hlETF/
├── server.js              # 后端服务主文件
│   ├── /api/backtest/static    # 静态回测接口
│   └── /api/backtest/dynamic   # 动态回测接口
├── public/
│   └── index.html        # 前端页面（统一回测界面）
├── package.json          # 项目配置
├── .env                  # 环境变量（需自行创建）
├── .env.example          # 环境变量示例
└── README.md            # 项目说明
```

## ⚠️ 注意事项

### Tushare权限要求
- **基础接口**（0积分）：`daily`、`stock_basic`
- **进阶接口**（2000积分）：`daily_basic`
- **高级接口**（5000积分）：`fund_portfolio`

### API调用限制
- 系统已实现批量处理和延迟机制
- 建议积分≥2000以获取完整数据
- 高频调用可能触发限流

### 回测局限性
- ⚠️ 不考虑交易成本和税费
- ⚠️ 不考虑流动性约束
- ⚠️ 不考虑冲击成本
- ⚠️ 历史表现不代表未来收益

## 📝 版本历史

### v2.1.0 (2024-12-10)
- ✨ 新增10%上限约束，符合双十规定
- 🔧 优化权重分配算法（迭代调整法）
- 📚 完善README文档

### v2.0.0 (2024-12-09)
- 🎯 改为市值加权策略
- 🔄 简化权重计算逻辑
- 🎨 统一回测页面UI

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## ⚠️ 免责声明

本系统仅供学习和研究使用，不构成任何投资建议。投资有风险，入市需谨慎。
